<div class="pedidos-container">
  <!-- Breadcrumb Navigation -->
  <div class="breadcrumb">
    <a routerLink="/dashboard" class="breadcrumb-item">
      <mat-icon>home</mat-icon>
      <span>Dashboard</span>
    </a>
    <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
    <span class="breadcrumb-item active">
      <mat-icon>restaurant_menu</mat-icon>
      <span>Pedidos</span>
    </span>
  </div>

  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-text">
        <div class="title-wrapper">
          <div class="title-icon">
            <mat-icon>restaurant_menu</mat-icon>
          </div>
          <div class="title-content">
            <h1>Gestión de Pedidos</h1>
            <p>
              <mat-icon>table_restaurant</mat-icon>
              <span>Administra los pedidos de las mesas en tiempo real</span>
            </p>
          </div>
        </div>
      </div>
      <div class="header-buttons">
        <button class="btn-adicionar" (click)="adicionarPedido()">
          <div class="btn-icon-wrapper">
            <mat-icon>add_circle</mat-icon>
          </div>
          <span class="btn-text">Adicionar</span>
        </button>
        <button class="btn-nuevo" (click)="nuevoPedido()">
          <div class="btn-icon-wrapper">
            <mat-icon>add</mat-icon>
          </div>
          <span class="btn-text">Nuevo Pedido</span>
          <div class="btn-shine"></div>
        </button>
      </div>
    </div>
  </div>

  <!-- Estadísticas rápidas -->
  <div class="stats-row">
    <div class="stat-item pendiente">
      <mat-icon>schedule</mat-icon>
      <div class="stat-info">
        <span class="stat-value">{{getPedidosPorEstado('abierto').length}}</span>
        <span class="stat-label">Pendientes</span>
      </div>
    </div>
    <div class="stat-item preparacion">
      <mat-icon>restaurant</mat-icon>
      <div class="stat-info">
        <span class="stat-value">{{getPedidosPorEstado('enviado_cocina').length}}</span>
        <span class="stat-label">En Preparación</span>
      </div>
    </div>
    <div class="stat-item listo">
      <mat-icon>check_circle</mat-icon>
      <div class="stat-info">
        <span class="stat-value">{{getPedidosPorEstado('cerrado').length}}</span>
        <span class="stat-label">Listos</span>
      </div>
    </div>
    <div class="stat-item total">
      <mat-icon>receipt_long</mat-icon>
      <div class="stat-info">
        <span class="stat-value">{{pedidos.length}}</span>
        <span class="stat-label">Total Activos</span>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div class="loader-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>Cargando pedidos...</p>
  </div>

  <!-- Kanban Board -->
  <div class="kanban-board" *ngIf="!loading && pedidos.length > 0">
    <!-- Columna Pendientes -->
    <div class="kanban-column pendiente">
      <div class="column-header">
        <div class="column-title">
          <mat-icon>schedule</mat-icon>
          <h3>Pendientes</h3>
          <span class="count">{{getPedidosPorEstado('abierto').length}}</span>
        </div>
      </div>
      <div class="column-content">
        <div class="pedido-card" *ngFor="let pedido of getPedidosPorEstado('abierto')">
          <div class="pedido-header">
            <div class="mesa-badge">
              <mat-icon>table_restaurant</mat-icon>
              <span>{{pedido.mesa_nombre || 'Mesa ' + pedido.mesa_id}}</span>
            </div>
            <span class="tiempo">{{getTiempoTranscurrido(pedido.fecha_creacion)}}</span>
          </div>

          <div class="pedido-items">
            <div class="item" *ngFor="let detalle of pedido.detalles">
              <span class="cantidad">{{detalle.cantidad}}x</span>
              <span class="nombre">{{detalle.producto_nombre}}</span>
            </div>
          </div>

          <div class="pedido-info">
            <div class="info-item">
              <mat-icon>person</mat-icon>
              <span>{{pedido.nombre_completo || pedido.nombre_usuario}}</span>
            </div>
            <div class="info-item total">
              <mat-icon>attach_money</mat-icon>
              <span>${{pedido.total | number:'1.2-2'}}</span>
            </div>
          </div>

          <div class="pedido-observaciones" *ngIf="pedido.observaciones">
            <mat-icon>comment</mat-icon>
            <p>{{pedido.observaciones}}</p>
          </div>

          <div class="pedido-actions">
            <button class="btn-adicionar" (click)="adicionarPedido(pedido)">
              <mat-icon>add_circle</mat-icon>
              <span>Adicionar</span>
            </button>
            <button class="btn-action" (click)="cambiarEstado(pedido.id, 'enviado_cocina')">
              <mat-icon>restaurant</mat-icon>
              <span>Enviar a Cocina</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Columna En Preparación -->
    <div class="kanban-column preparacion">
      <div class="column-header">
        <div class="column-title">
          <mat-icon>restaurant</mat-icon>
          <h3>En Preparación</h3>
          <span class="count">{{getPedidosPorEstado('enviado_cocina').length}}</span>
        </div>
      </div>
      <div class="column-content">
        <div class="pedido-card" *ngFor="let pedido of getPedidosPorEstado('enviado_cocina')">
          <div class="pedido-header">
            <div class="mesa-badge">
              <mat-icon>table_restaurant</mat-icon>
              <span>{{pedido.mesa_nombre || 'Mesa ' + pedido.mesa_id}}</span>
            </div>
            <span class="tiempo">{{getTiempoTranscurrido(pedido.fecha_creacion)}}</span>
          </div>

          <div class="pedido-items">
            <div class="item" *ngFor="let detalle of pedido.detalles">
              <span class="cantidad">{{detalle.cantidad}}x</span>
              <span class="nombre">{{detalle.producto_nombre}}</span>
            </div>
          </div>

          <div class="pedido-info">
            <div class="info-item">
              <mat-icon>person</mat-icon>
              <span>{{pedido.nombre_completo || pedido.nombre_usuario}}</span>
            </div>
            <div class="info-item total">
              <mat-icon>attach_money</mat-icon>
              <span>${{pedido.total | number:'1.2-2'}}</span>
            </div>
          </div>

          <div class="pedido-observaciones" *ngIf="pedido.observaciones">
            <mat-icon>comment</mat-icon>
            <p>{{pedido.observaciones}}</p>
          </div>

          <div class="pedido-actions">
            <button class="btn-adicionar" (click)="adicionarPedido(pedido)">
              <mat-icon>add_circle</mat-icon>
              <span>Adicionar</span>
            </button>
            <button class="btn-action" (click)="cambiarEstado(pedido.id, 'listo')">
              <mat-icon>check_circle</mat-icon>
              <span>Marcar como Listo</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Columna Listos -->
    <div class="kanban-column listo">
      <div class="column-header">
        <div class="column-title">
          <mat-icon>check_circle</mat-icon>
          <h3>Listos</h3>
          <span class="count">{{getPedidosPorEstado('cerrado').length}}</span>
        </div>
      </div>
      <div class="column-content">
        <div class="pedido-card" *ngFor="let pedido of getPedidosPorEstado('cerrado')">
          <div class="pedido-header">
            <div class="mesa-badge">
              <mat-icon>table_restaurant</mat-icon>
              <span>{{pedido.mesa_nombre || 'Mesa ' + pedido.mesa_id}}</span>
            </div>
            <span class="tiempo">{{getTiempoTranscurrido(pedido.fecha_creacion)}}</span>
          </div>

          <div class="pedido-items">
            <div class="item" *ngFor="let detalle of pedido.detalles">
              <span class="cantidad">{{detalle.cantidad}}x</span>
              <span class="nombre">{{detalle.producto_nombre}}</span>
            </div>
          </div>

          <div class="pedido-info">
            <div class="info-item">
              <mat-icon>person</mat-icon>
              <span>{{pedido.nombre_completo || pedido.nombre_usuario}}</span>
            </div>
            <div class="info-item total">
              <mat-icon>attach_money</mat-icon>
              <span>${{pedido.total | number:'1.2-2'}}</span>
            </div>
          </div>

          <div class="pedido-observaciones" *ngIf="pedido.observaciones">
            <mat-icon>comment</mat-icon>
            <p>{{pedido.observaciones}}</p>
          </div>

          <button class="btn-action" (click)="cambiarEstado(pedido.id, 'cerrado')">
            <mat-icon>delivery_dining</mat-icon>
            <span>Entregar a Mesa</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty state -->
  <div class="empty-state" *ngIf="!loading && pedidos.length === 0">
    <div class="empty-icon">
      <mat-icon>restaurant_menu</mat-icon>
    </div>
    <h3>No hay pedidos activos</h3>
    <p>Los pedidos aparecerán aquí cuando se creen</p>
    <button class="btn-nuevo" (click)="nuevoPedido()">
      <mat-icon>add_circle</mat-icon>
      <span>Crear Primer Pedido</span>
    </button>
  </div>
</div>
